<%= render "shared/title", text: "Firmware" %>

<section class="page-firmware">
  <header class="bit-header">
    <h1 class="label">
      Firmware

      <button class="bit-popover-trigger" popovertarget="popover-help">
        <%= image_tag "icons/info.svg", width: 20, height: 20, loading: :lazy %>
      </button>
    </h1>

    <dialog id="popover-help" class="bit-popover-content" popover="auto">
      <button class="close" popovertarget="popover-help" popovertargetaction="hide">
        <span aria-hidden=true>‚ùå</span>
        <span class="screen_reader">Close</span>
      </button>

      <h3 class="label">Overview</h3>

      <p>This is where you can manage the firmware updates for your device(s). New versions will automatically appear via the Firmware Poller (see Terminus project documentation for details).</p>

      <p>To revert to a previous version, temporarily disable the Firmware Poller and your devices will downgrade when the next waking. Alternatively, you can disable the Firmware Poller and short press the button on the back of your devices to force a revert.</p>

      <h3 class="label">Search</h3>

      <p>You can fuzzy search by version using partial or full version information.</p>
    </dialog>

    <div class="actions">
      <%= render "shared/search",
                 path: routes.path(:firmware),
                 query:,
                 pick: ".bit-container",
                 target: "next .bit-container" %>

      <%= render "shared/delete",
                 path: routes.path(:bulk_firmware_delete),
                 label: "Delete All",
                 class: "bit-button-danger",
                 confirm: "Are you sure you want to delete all firmware?",
                 target: ".bit-container" %>
    </div>
  </header>

  <div class="bit-container">
    <% if firmware.any? %>
      <table>
        <thead>
          <tr>
            <th>Version</th>
            <th>Size</th>
            <th>Downloaded At</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <% firmware.each do |record| %>
            <%= record.render :firmware, firmware: record %>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <%= render "shared/empty", message: "No firmware found." %>
    <% end %>
  </div>
</section>
