#! /usr/bin/env ruby
# frozen_string_literal: true

require "pathname"

$VERBOSE = true

jemalloc_path = Dir["/usr/lib/*/libjemalloc.so.2"]
ENV["LD_PRELOAD"] = jemalloc_path.first unless ENV.key?("LD_PRELOAD") && jemalloc_path.empty?

Pathname(".overmind.sock").tap { it.delete if it.exist? }

system "bundle exec hanami db migrate"
system ARGV.join(" ")
